{% extends 'base.html' %}
{% load static %}
{% load gravatar %}
{% block app %}
<section class="section">
  <div class="container">
    <section class="section" style="padding-top: 0; padding-bottom: 0;">
      <article class="media">
        <figure class="media-left">
          <p class="image is-64x64">
            <img src="{{ person.email|gravatar_url:128 }}" class="img-thumbnail p-2 mr-3"
                 alt="{{ person.username }}'s gravatar">
          </p>
        </figure>
        <div class="media-content">
          <div class="content">
            <p>
              <span style="
                font-family: 'Noto Sans KR';
                font-weight: 700;
                font-size: 1.5rem;
                color: #fff;
                margin-right: 0.5rem;
              ">
                {{ person.username }}
              </span>
              {% if user != person %}
              <button v-show="!is_follow" class="button is-primary" @click="follow('{{ person.username }}')">팔로우</button>
              <button v-show="is_follow" class="button is-light is-outlined" @click="follow('{{ person.username }}')">팔로잉</button>
              {% endif %}
            </p>
          </div>
          <nav class="level is-mobile">
            <div class="level-left">
              <span class="level-item" style="color: #fff;">
                여기에 어떤 걸 쓸까
              </span>
            </div>
          </nav>
        </div>
        <nav class="level-left has-text-white-bis">
          <div class="level-item has-text-centered">
            <div>
              <p class="heading">Following</p>
              <p class="title has-text-white-bis">[[ followings ]]</p>
            </div>
          </div>
          <div class="level-item has-text-centered">
            <div>
              <p class="heading">Followers</p>
              <p class="title has-text-white-bis">[[ followers ]]</p>
            </div>
          </div>
          <div class="level-item has-text-centered">
            <div>
              <p class="heading">Ratings</p>
              <p class="title has-text-white-bis">[[ ratings ]]</p>
            </div>
          </div>
        </nav>
      </article>
    </section>
  </div>
{% endblock %}

{% block script %}
  <script>
    const profile = new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data: {
        is_follow : {% if person in user.from_user.all %} true {% else %} false {% endif %},
        followings : {{ person.from_user.count }},
        followers : {{ person.to_user.count }},
        ratings : {{ person.ratings.count }},
      },
      methods: {
        follow : function (person) {
          const url = "{% url 'accounts:profile_follow' 'asd'%}".replace('asd', person);
          axios.get(url).then(res => {
            if (res.data.is_follow) {
              this.followers ++;
              this.is_follow = true;
            } else {
              this.followers --;
              this.is_follow = false;
            }
          });
        },
      },
    })
  </script>
{% endblock %}