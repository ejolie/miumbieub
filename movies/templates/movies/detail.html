{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block app %}
<section class="section movie-detail" style="padding-top: 6rem;">
  <div class="container">
    <!-- Movie Detail -->
    <div class="columns is-centered" style="margin-bottom: 10rem;">
      <div class="column" style="display:flex; justify-content: center; align-items: center;">
        <div class="content" style="max-width: 650px">
          <!-- Movie Poster -->
          <div class="gradient-box"><img src="{{ movie.poster_url }}" width="650"></div>
          <!-- Genres -->
          <div class="tags" style="margin-top: 1.8rem; margin-bottom: 0.2rem;">
            {% for genre in movie.genres.all %}
            <span class="tag is-primary">{{ genre.type }}</span>
            {% endfor %}
          </div>
          <h1 class="title" style="margin-top: 0.8rem; margin-bottom: 1rem;">{{ movie.title }}</h1>
          <div class="movie-description" style="line-height: 1.6">
            <small>{{ movie.release }} 개봉</small>
            &bull; <small>{{ movie.film_rating }}</small>
            &bull; <small><i class="fas fa-users"></i> {{ movie.audience | intcomma }}명</small>
            <div class="content" style="margin-top: 1rem;">
              <p style="margin-bottom: 0">감독 : {{ movie.director }}</p>
              <p style="margin-bottom: 0">배우 : {{ movie.actor1 }}, {{ movie.actor2 }}, {{ movie.actor3 }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Comments -->
    <div class="columns is-centered" style="margin-top: 2rem; margin-bottom: 5rem;" id="comments">
      <div class="column comments" style="max-width: 650px; padding: 0;">
        <hr/>
        {% include 'movies/_comments.html' %}
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block script %}
<script>
  const detail = new Vue({
    el: '#comments',
    delimiters: ['[[', ']]'],
    data: {
      ratingList: [],
      rating: {
        score: 0,
        comment: '',
      },
      temp_value: null,
      ratings: [1, 2, 3, 4, 5],
    },
    
    methods: {
      star_over: function(index) {
        this.temp_value = this.rating.score;
        this.rating.score = index;
      },
  
      star_out: function() {
        this.rating.score = this.temp_value;
      },
  
      set: function(num) {
        this.temp_value = num;
        this.rating.score = num;
      },
      
      createRating: function(user, movie) {
        console.log(user); 
        console.log(movie);
        
        const data = {
          ...this.rating,
          user, 
          movie 
        }
        
        axios.defaults.xsrfCookieName = 'csrftoken';
        axios.defaults.xsrfHeaderName = 'X-CSRFToken';
        axios.post(`ratings/`, data)
          .then(res => {
            console.log(res);
            this.ratingList.push(this.rating);
            this.rating.comment = '';
            this.rating.score = 0;
          })
          .catch(err => console.log(err))
      },
    },
    
    created() {
      axios.get(`ratings/`)
        .then(res => {
          this.ratingList = res.data;
        })
        .catch(err => console.log(err));
    }
  })

</script>
{% endblock %}